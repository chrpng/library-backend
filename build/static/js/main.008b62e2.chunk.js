(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{66:function(t,e,n){t.exports=n(87)},87:function(t,e,n){"use strict";n.r(e);var a=n(59),r=n(2),l=n.n(r),u=n(60),o=n.n(u),c=n(34),i=n(10),s=n(5),b=n(19);function m(){var t=Object(b.a)(["\n\tsubscription {\n\t\tauthorAdded {\n\t\t\tname\n\t\t\tborn\n\t\t\tbookCount\n\t\t\tid\n\t\t}\n\t}\n"]);return m=function(){return t},t}function d(){var t=Object(b.a)(["\n\tsubscription {\n\t\tbookAdded {\n\t\t\t...BookDetails\n\t\t}\n\t}\n\t","\n"]);return d=function(){return t},t}function v(){var t=Object(b.a)(["\n\tquery {\n\t\tme {\n\t\t\tusername\n\t\t\tfavoriteGenre\n\t\t\tid\n\t\t}\n\t}\n"]);return v=function(){return t},t}function f(){var t=Object(b.a)(["\n\tmutation login($username: String!, $password: String!) {\n\t\tlogin(username: $username, password: $password) {\n\t\t\tvalue\n\t\t}\n\t}\n"]);return f=function(){return t},t}function E(){var t=Object(b.a)(["\n\tquery {\n\t\tallGenres\n\t}\n"]);return E=function(){return t},t}function h(){var t=Object(b.a)(["\n\tmutation updateAuthor($name: String!, $setBornTo: Int!) {\n\t\teditAuthor(name: $name, setBornTo: $setBornTo) {\n\t\t\tname\n\t\t\tborn\n\t\t\tid\n\t\t}\n\t}\n"]);return h=function(){return t},t}function j(){var t=Object(b.a)(["\n\tmutation createBook($title: String!, $author: String!, $published: Int!, $genres: [String!]!) {\n\t\taddBook(title: $title, author: $author, published: $published, genres: $genres) {\n\t\t\ttitle\n\t\t\tauthor {\n\t\t\t\tname\n\t\t\t}\n\t\t\tpublished\n\t\t\tid\n\t\t}\n\t}\n"]);return j=function(){return t},t}function O(){var t=Object(b.a)(["\n\tquery getBooksByGenre($genreToSelect: String) {\n\t\tallBooks(genre: $genreToSelect) {\n\t\t\ttitle\n\t\t\tauthor {\n\t\t\t\tname\n\t\t\t}\n\t\t\tgenres\n\t\t\tpublished\n\t\t\tid\n\t\t}\n\t}\n"]);return O=function(){return t},t}function p(){var t=Object(b.a)(["\n\tquery {\n\t\tallAuthors {\n\t\t\tname\n\t\t\tborn\n\t\t\tbookCount\n\t\t\tid\n\t\t}\n\t}\n"]);return p=function(){return t},t}function g(){var t=Object(b.a)(["\n\tfragment BookDetails on Book {\n\t\ttitle\n\t\tauthor {\n\t\t\tname\n\t\t}\n\t\tgenres\n\t\tpublished\n\t\tid\n\t}\n"]);return g=function(){return t},t}var k=Object(s.gql)(g()),y=Object(s.gql)(p()),S=Object(s.gql)(O()),w=Object(s.gql)(j()),C=Object(s.gql)(h()),q=Object(s.gql)(E()),$=Object(s.gql)(f()),B=Object(s.gql)(v()),A=Object(s.gql)(d(),k),D=Object(s.gql)(m()),T=function(t){var e,n=t.authors,a=Object(r.useState)((null===(e=n[0])||void 0===e?void 0:e.name)||""),u=Object(i.a)(a,2),o=u[0],c=u[1],b=Object(r.useState)(""),m=Object(i.a)(b,2),d=m[0],v=m[1],f=Object(s.useMutation)(C,{onError:function(t){console.log(t)}}),E=Object(i.a)(f,1)[0];return l.a.createElement("div",null,l.a.createElement("h2",null,"Set birth year"),l.a.createElement("form",{onSubmit:function(t){t.preventDefault(),console.log(o),E({variables:{name:o,setBornTo:d}}),v("")}},l.a.createElement("div",null,l.a.createElement("select",{value:o,onChange:function(t){var e=t.target;return c(e.value)}},null===n||void 0===n?void 0:n.map((function(t){return l.a.createElement("option",{key:t.id,value:t.name},t.name)})))),l.a.createElement("div",null,"born",l.a.createElement("input",{value:d,onChange:function(t){var e=t.target;return v(parseInt(e.value))}})),l.a.createElement("button",{type:"submit"},"update author")))},I=function(t){var e,n=t.show,a=null===(e=Object(s.useQuery)(y).data)||void 0===e?void 0:e.allAuthors;return n?l.a.createElement("div",null,l.a.createElement("h2",null,"authors"),l.a.createElement("table",null,l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("th",null),l.a.createElement("th",null,"born"),l.a.createElement("th",null,"books")),null===a||void 0===a?void 0:a.map((function(t){return l.a.createElement("tr",{key:t.name},l.a.createElement("td",null,t.name),l.a.createElement("td",null,t.born),l.a.createElement("td",null,t.bookCount))})))),a&&l.a.createElement(T,{authors:a})):null},Q=function(t){var e=t.show,n=Object(r.useState)(null),a=Object(i.a)(n,2),u=a[0],o=a[1],c=Object(r.useState)(null),b=Object(i.a)(c,2),m=b[0],d=b[1],v=Object(r.useState)(null),f=Object(i.a)(v,2),E=f[0],h=f[1],j=Object(s.useQuery)(q),O=Object(s.useLazyQuery)(S),p=Object(i.a)(O,2),g=p[0],k=p[1],y=function(t){g({variables:{genreToSelect:t}}),o(t)};return Object(r.useEffect)((function(){k.data||k.loading?k.data&&d(k.data.allBooks):g()}),[k.data]),Object(r.useEffect)((function(){j.data&&h(j.data.allGenres)}),[j.data]),e?l.a.createElement("div",null,l.a.createElement("h2",null,"books"),u&&l.a.createElement("div",null,u," selected"),l.a.createElement("table",null,l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("th",null),l.a.createElement("th",null,"author"),l.a.createElement("th",null,"published")),m&&m.map((function(t){return l.a.createElement("tr",{key:t.title},l.a.createElement("td",null,t.title),l.a.createElement("td",null,t.author.name),l.a.createElement("td",null,t.published))})))),l.a.createElement("div",null,E&&E.map((function(t){return l.a.createElement("button",{key:t,onClick:function(){return y(t)}},t)})),l.a.createElement("button",{onClick:function(){return y(null)}},"all genres"))):null},G=n(41),M=n.n(G),x=n(62),z=function(t){var e=Object(r.useState)(""),n=Object(i.a)(e,2),a=n[0],u=n[1],o=Object(r.useState)(""),c=Object(i.a)(o,2),b=c[0],m=c[1],d=Object(r.useState)(""),v=Object(i.a)(d,2),f=v[0],E=v[1],h=Object(r.useState)(""),j=Object(i.a)(h,2),O=j[0],p=j[1],g=Object(r.useState)([]),k=Object(i.a)(g,2),y=k[0],S=k[1],C=Object(s.useMutation)(w,{onError:function(t){console.log(t)}}),q=Object(i.a)(C,1)[0];if(!t.show)return null;var $=function(){var t=Object(x.a)(M.a.mark((function t(e){return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.preventDefault(),q({variables:{title:a,author:b,published:f,genres:y}}),u(""),E(""),m(""),S([]),p("");case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return l.a.createElement("div",null,l.a.createElement("form",{onSubmit:$},l.a.createElement("div",null,"title",l.a.createElement("input",{value:a,onChange:function(t){var e=t.target;return u(e.value)}})),l.a.createElement("div",null,"author",l.a.createElement("input",{value:b,onChange:function(t){var e=t.target;return m(e.value)}})),l.a.createElement("div",null,"published",l.a.createElement("input",{type:"number",value:f,onChange:function(t){var e=t.target;return E(parseInt(e.value))}})),l.a.createElement("div",null,l.a.createElement("input",{value:O,onChange:function(t){var e=t.target;return p(e.value)}}),l.a.createElement("button",{onClick:function(){S(y.concat(O)),p("")},type:"button"},"add genre")),l.a.createElement("div",null,"genres: ",y.join(" ")),l.a.createElement("button",{type:"submit"},"create book")))},L=function(t){var e,n,a=t.show,u=Object(r.useState)(null),o=Object(i.a)(u,2),c=o[0],b=o[1],m=null===(e=Object(s.useQuery)(B).data)||void 0===e?void 0:null===(n=e.me)||void 0===n?void 0:n.favoriteGenre,d=Object(s.useLazyQuery)(S,{variables:{genreToSelect:m}}),v=Object(i.a)(d,2),f=v[0],E=v[1];return Object(r.useEffect)((function(){f()}),[]),Object(r.useEffect)((function(){E.data&&b(E.data.allBooks)}),[E.data]),a?l.a.createElement("div",null,l.a.createElement("h2",null,"recommendations"),m&&l.a.createElement("div",null,"books in your favorite genre ",m),l.a.createElement("table",null,l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("th",null),l.a.createElement("th",null,"author"),l.a.createElement("th",null,"published")),c&&c.map((function(t){return l.a.createElement("tr",{key:t.title},l.a.createElement("td",null,t.title),l.a.createElement("td",null,t.author.name),l.a.createElement("td",null,t.published))}))))):null},P=function(t){var e=t.show,n=t.setToken,a=t.setPage,u=Object(r.useState)(""),o=Object(i.a)(u,2),c=o[0],b=o[1],m=Object(r.useState)(""),d=Object(i.a)(m,2),v=d[0],f=d[1],E=Object(s.useMutation)($),h=Object(i.a)(E,2),j=h[0],O=h[1];return Object(r.useEffect)((function(){if(O.data){console.log(O);var t=O.data.login.value;n(t),localStorage.setItem("library-user-token",t),a("authors")}}),[O.data]),e?l.a.createElement("div",null,l.a.createElement("form",{onSubmit:function(t){t.preventDefault(),j({variables:{username:c,password:v}}),b(""),f("")}},l.a.createElement("div",null,"username",l.a.createElement("input",{type:"text",value:c,onChange:function(t){var e=t.target;return b(e.value)}})),l.a.createElement("div",null,"password",l.a.createElement("input",{type:"password",value:v,onChange:function(t){var e=t.target;return f(e.value)}})),l.a.createElement("button",{type:"submit"},"login"))):null},J=function(){var t=Object(r.useState)(null),e=Object(i.a)(t,2),n=e[0],a=e[1],u=Object(r.useState)("authors"),o=Object(i.a)(u,2),b=o[0],m=o[1],d=Object(s.useApolloClient)();Object(r.useEffect)((function(){var t=localStorage.getItem("library-user-token");t&&a(t)}),[]),Object(s.useSubscription)(A,{onSubscriptionData:function(t){var e=t.subscriptionData;console.log(e);var n=e.data.bookAdded;v(n,"allBooks",S)}}),Object(s.useSubscription)(D,{onSubscriptionData:function(t){var e=t.subscriptionData;console.log(e);var n=e.data.authorAdded;v(n,"allAuthors",y)}});var v=function(t,e,n){var a,r,l=d.readQuery({query:n});console.log(l),a=l[e],r=t,a.map((function(t){return t.id})).includes(r.id)||d.writeQuery({query:n,data:Object(c.a)({},e,l[e].concat(t))})};return l.a.createElement("div",null,l.a.createElement("div",null,l.a.createElement("button",{onClick:function(){return m("authors")}},"authors"),l.a.createElement("button",{onClick:function(){return m("books")}},"books"),n?l.a.createElement(l.a.Fragment,null,l.a.createElement("button",{onClick:function(){return m("add")}},"add book"),l.a.createElement("button",{onClick:function(){return m("recommend")}},"recommend"),l.a.createElement("button",{onClick:function(t){t.preventDefault(),a(null),localStorage.clear()}},"logout")):l.a.createElement("button",{onClick:function(){return m("login")}},"login")),l.a.createElement(I,{show:"authors"===b}),l.a.createElement(Q,{show:"books"===b}),l.a.createElement(z,{show:"add"===b}),l.a.createElement(L,{show:"recommend"===b}),l.a.createElement(P,{show:"login"===b,setToken:a,setPage:m}))},F=n(65),H=n(1),K=n(63),N=Object(F.a)((function(t,e){var n=e.headers,r=localStorage.getItem("library-user-token");return{headers:Object(a.a)({},n,{authorization:r?"bearer ".concat(r):null})}})),R=new s.HttpLink({uri:"http://localhost:4000"}),U=new K.a({uri:"ws://localhost:4000/graphql",options:{reconnect:!0}}),V=Object(s.split)((function(t){var e=t.query,n=Object(H.p)(e);return"OperationDefinition"===n.kind&&"subscription"===n.operation}),U,N.concat(R)),W=new s.ApolloClient({cache:new s.InMemoryCache,link:V});o.a.render(l.a.createElement(s.ApolloProvider,{client:W},l.a.createElement(J,null)),document.getElementById("root"))}},[[66,1,2]]]);
//# sourceMappingURL=main.008b62e2.chunk.js.map